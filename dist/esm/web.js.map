{"version":3,"file":"web.js","sourceRoot":"","sources":["../../src/web.ts"],"names":[],"mappings":"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","sourcesContent":["import { WebPlugin } from '@capacitor/core';\nimport { BarcodeFormat, BrowserQRCodeReader, IScannerControls } from '@zxing/browser';\nimport { DecodeHintType } from '@zxing/library';\n\nimport {\n  BarcodeScannerPlugin,\n  ScanOptions,\n  ScanResult,\n  CheckPermissionOptions,\n  CheckPermissionResult,\n  StopScanOptions,\n  TorchStateResult,\n  CameraDirection,\n  IScanResultWithContent,\n} from './definitions';\n\nexport class BarcodeScannerWeb extends WebPlugin implements BarcodeScannerPlugin {\n  private static _FORWARD = { facingMode: 'user' };\n  private static _BACK = { facingMode: 'environment' };\n  private _formats: number[] = [];\n  private _controls: IScannerControls | null = null;\n  private _torchState = false;\n  private _video: HTMLVideoElement | null = null;\n  private _options: ScanOptions | null = null;\n  private _backgroundColor: string | null = null;\n  private _facingMode: MediaTrackConstraints = BarcodeScannerWeb._BACK;\n\n  async prepare(): Promise<void> {\n    await this._getVideoElement();\n    return;\n  }\n\n  async hideBackground(): Promise<void> {\n    this._backgroundColor = document.documentElement.style.backgroundColor;\n    document.documentElement.style.backgroundColor = 'transparent';\n    return;\n  }\n\n  async showBackground(): Promise<void> {\n    document.documentElement.style.backgroundColor = this._backgroundColor || '';\n    return;\n  }\n\n  async startScan(_options: ScanOptions): Promise<ScanResult> {\n    this._options = _options;\n    this._formats = [];\n    _options?.targetedFormats?.forEach((format) => {\n      const formatIndex = Object.keys(BarcodeFormat).indexOf(format);\n      if (formatIndex >= 0) {\n        this._formats.push(0);\n      } else {\n        console.error(format, 'is not supported on web');\n      }\n    });\n    if (!!_options?.cameraDirection) {\n      this._facingMode = _options.cameraDirection === CameraDirection.BACK ? BarcodeScannerWeb._BACK : BarcodeScannerWeb._FORWARD;\n    }\n    const video = await this._getVideoElement();\n    if (video) {\n      return await this._getFirstResultFromReader();\n    } else {\n      throw this.unavailable('Missing video element');\n    }\n  }\n\n  async startScanning(_options: ScanOptions, _callback: any): Promise<string> {\n    throw this.unimplemented('Not implemented on web.');\n  }\n\n  async pauseScanning(): Promise<void> {\n    if (this._controls) {\n      this._controls.stop();\n      this._controls = null;\n    }\n  }\n\n  async resumeScanning(): Promise<void> {\n    this._getFirstResultFromReader();\n  }\n\n  async stopScan(_options?: StopScanOptions): Promise<void> {\n    this._stop();\n    if (this._controls) {\n      this._controls.stop();\n      this._controls = null;\n    }\n  }\n\n  async checkPermission(_options: CheckPermissionOptions): Promise<CheckPermissionResult> {\n    if (typeof navigator === 'undefined' || !navigator.permissions) {\n      throw this.unavailable('Permissions API not available in this browser');\n    }\n\n    try {\n      // https://developer.mozilla.org/en-US/docs/Web/API/Permissions/query\n      // the specific permissions that are supported varies among browsers that implement the\n      // permissions API, so we need a try/catch in case 'camera' is invalid\n      const permission = await window.navigator.permissions.query({\n        name: 'camera' as any,\n      });\n      if (permission.state === 'prompt') {\n        return {\n          neverAsked: true,\n        };\n      }\n      if (permission.state === 'denied') {\n        return {\n          denied: true,\n        };\n      }\n      if (permission.state === 'granted') {\n        return {\n          granted: true,\n        };\n      }\n      return {\n        unknown: true,\n      };\n    } catch {\n      throw this.unavailable('Camera permissions are not available in this browser');\n    }\n  }\n\n  async openAppSettings(): Promise<void> {\n    throw this.unavailable('App settings are not available in this browser');\n  }\n\n  async disableTorch(): Promise<void> {\n    if (this._controls && this._controls.switchTorch) {\n      this._controls.switchTorch(false);\n      this._torchState = false;\n    }\n  }\n\n  async enableTorch(): Promise<void> {\n    if (this._controls && this._controls.switchTorch) {\n      this._controls.switchTorch(true);\n      this._torchState = true;\n    }\n  }\n\n  async toggleTorch(): Promise<void> {\n    if (this._controls && this._controls.switchTorch) {\n      this._controls.switchTorch(true);\n    }\n  }\n\n  async getTorchState(): Promise<TorchStateResult> {\n    return { isEnabled: this._torchState };\n  }\n\n  private async _getVideoElement() {\n    if (!this._video) {\n      await this._startVideo();\n    }\n    return this._video;\n  }\n\n  private async _getFirstResultFromReader() {\n    const videoElement = await this._getVideoElement();\n    return new Promise<IScanResultWithContent>(async (resolve) => {\n      if (videoElement) {\n        let hints;\n        if (this._formats.length) {\n          hints = new Map();\n          hints.set(DecodeHintType.POSSIBLE_FORMATS, this._formats);\n        }\n        const reader = new BrowserQRCodeReader(hints);\n        this._controls = await reader.decodeFromVideoElement(videoElement, (result, error, controls) => {\n          if (!error && result && result.getText()) {\n            resolve({\n              hasContent: true,\n              content: result.getText(),\n              format: result.getBarcodeFormat().toString(),\n            });\n            controls.stop();\n            this._controls = null;\n            this._stop();\n          }\n          if (error && error.message) {\n            console.error(error.message);\n          }\n        });\n      }\n    });\n  }\n\n  private async _startVideo(): Promise<{}> {\n    return new Promise(async (resolve, reject) => {\n      await navigator.mediaDevices\n        .getUserMedia({\n          audio: false,\n          video: true,\n        })\n        .then((stream: MediaStream) => {\n          // Stop any existing stream so we can request media with different constraints based on user input\n          stream.getTracks().forEach((track) => track.stop());\n        })\n        .catch((error) => {\n          reject(error);\n        });\n\n      const body = document.body;\n      const video = document.getElementById('video');\n\n      if (!video) {\n        const parent = document.createElement('div');\n        parent.setAttribute(\n          'style',\n          'position:absolute; top: 0; left: 0; width:100%; height: 100%; background-color: black;'\n        );\n        this._video = document.createElement('video');\n        this._video.id = 'video';\n        // Don't flip video feed if camera is rear facing\n        if (this._options?.cameraDirection !== CameraDirection.BACK) {\n          this._video.setAttribute(\n            'style',\n            '-webkit-transform: scaleX(-1); transform: scaleX(-1); width:100%; height: 100%;'\n          );\n        } else {\n          this._video.setAttribute('style', 'width:100%; height: 100%;');\n        }\n\n        const userAgent = navigator.userAgent.toLowerCase();\n        const isSafari = userAgent.includes('safari') && !userAgent.includes('chrome');\n\n        // Safari on iOS needs to have the autoplay, muted and playsinline attributes set for video.play() to be successful\n        // Without these attributes this.video.play() will throw a NotAllowedError\n        // https://developer.apple.com/documentation/webkit/delivering_video_content_for_safari\n        if (isSafari) {\n          this._video.setAttribute('autoplay', 'true');\n          this._video.setAttribute('muted', 'true');\n          this._video.setAttribute('playsinline', 'true');\n        }\n\n        parent.appendChild(this._video);\n        body.appendChild(parent);\n\n        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n          const constraints: MediaStreamConstraints = {\n            video: this._facingMode,\n          };\n\n          navigator.mediaDevices.getUserMedia(constraints).then(\n            (stream) => {\n              //video.src = window.URL.createObjectURL(stream);\n              if (this._video) {\n                this._video.srcObject = stream;\n                this._video.play();\n              }\n              resolve({});\n            },\n            (err) => {\n              reject(err);\n            }\n          );\n        }\n      } else {\n        reject({ message: 'camera already started' });\n      }\n    });\n  }\n\n  private async _stop(): Promise<any> {\n    if (this._video) {\n      this._video.pause();\n\n      const st: any = this._video.srcObject;\n      const tracks = st.getTracks();\n\n      for (var i = 0; i < tracks.length; i++) {\n        var track = tracks[i];\n        track.stop();\n      }\n      this._video.parentElement?.remove();\n      this._video = null;\n    }\n  }\n}\n"]}